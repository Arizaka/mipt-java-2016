Описание устройства KlabertancOptimizedStorage

База данных представляет собой объединение из [(число ключей) / MAX_CACHE_SIZE] + 1 файла. Все файлы, кроме storage.db (в котором размещены ключи и их позиции), хранятся в ArrayList. Позиция ключа - номер файла, в котором хранится соответствующее значение и смещение в этом файле. Так же имеется два Map’a на чтение и запись, которые ускоряют доступ к недавним ключам. При превышении ими максимально допустимого размера, кэш для чтения очищается, кэш для записи создает на диске новый файл (который помещает в ArrayList), а свое содержимое пишет в этот файл (и очищается). При чтении ключа мы сначала проверяем его в кэшах, а затем уже идем на диск. При записи мы сначала кладем ключ в кэш. Мы всегда кладем ключ в основной кэш с позицией (-1, -1) для работы итератора (затем при дампе мы перепишем эту позицию).